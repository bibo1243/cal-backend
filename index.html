<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹å®®æ ¼å¹´åº¦è¦åŠƒç³»çµ± - Cal Planner</title>
    <!-- å°å…¥ XLSX åº« -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* CSS è®Šé‡å®šç¾©ï¼š8ç¨®é¢¨æ ¼ */
        :root {
            --bg-primary: #f5f8f5; --bg-secondary: #ffffff; --text-primary: #2d4a2b; --text-secondary: #5a7658;
            --accent: #6b9e78; --accent-light: #d8e8db; --accent-dark: #4a7552;
            --border: #d4e0d4; --shadow: rgba(45, 74, 43, 0.08);
            --center-bg: linear-gradient(135deg, rgba(107, 158, 120, 0.95) 0%, rgba(74, 117, 82, 0.95) 100%);
            --month-badge: #88b894;
        }
        
        /* 1. ç«¹æ—é’ç¿  (Bamboo) */
        body.bamboo { --bg-primary: #f5f8f5; --accent: #6b9e78; --center-bg: linear-gradient(135deg, #6b9e78 0%, #4a7552 100%); }
        /* 2. æ«»èŠ±ç²‰é›… (Sakura) */
        body.sakura { --bg-primary: #fff0f5; --text-primary: #5d4157; --accent: #ffb7c5; --accent-light: #ffe4e1; --accent-dark: #db7093; --center-bg: linear-gradient(135deg, #ffb7c5 0%, #db7093 100%); }
        /* 3. è“®æ± éœè— (Lotus) */
        body.lotus { --bg-primary: #f0f8ff; --text-primary: #2c3e50; --accent: #87ceeb; --accent-light: #e0ffff; --accent-dark: #4682b4; --center-bg: linear-gradient(135deg, #87ceeb 0%, #4682b4 100%); }
        /* 4. æ™šéœæ©™æš– (Sunset) */
        body.sunset { --bg-primary: #fff5e6; --text-primary: #5d4037; --accent: #ffab91; --accent-light: #ffe0b2; --accent-dark: #d84315; --center-bg: linear-gradient(135deg, #ffab91 0%, #d84315 100%); }
        /* 5. æ·±æµ·æ¹›è— (Ocean) */
        body.ocean { --bg-primary: #e3f2fd; --text-primary: #0d47a1; --accent: #2196f3; --accent-light: #bbdefb; --accent-dark: #1565c0; --center-bg: linear-gradient(135deg, #2196f3 0%, #1565c0 100%); }
        /* 6. è–°è¡£è‰ç´« (Lavender) */
        body.lavender { --bg-primary: #f3e5f5; --text-primary: #4a148c; --accent: #ce93d8; --accent-light: #f3e5f5; --accent-dark: #8e24aa; --center-bg: linear-gradient(135deg, #ce93d8 0%, #8e24aa 100%); }
        /* 7. ç§‹æ¥“ç´…è‘‰ (Autumn) */
        body.autumn { --bg-primary: #fff3e0; --text-primary: #3e2723; --accent: #ffcc80; --accent-light: #ffe0b2; --accent-dark: #e65100; --center-bg: linear-gradient(135deg, #ffcc80 0%, #e65100 100%); }
        /* 8. æš—å¤œæ¥µå…‰ (Midnight) */
        body.midnight { --bg-primary: #263238; --bg-secondary: #37474f; --text-primary: #eceff1; --text-secondary: #b0bec5; --accent: #80cbc4; --accent-light: #546e7a; --accent-dark: #009688; --border: #455a64; --shadow: rgba(0,0,0,0.3); --center-bg: linear-gradient(135deg, #263238 0%, #009688 100%); }

        body { 
            font-family: system-ui, -apple-system, sans-serif;
            background: var(--bg-primary); color: var(--text-primary); 
            line-height: 1.6; min-height: 100vh; padding: 30px 20px; 
            transition: all 0.5s ease; 
        }
        
        .container { max-width: 1400px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; }
        h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .subtitle { opacity: 0.8; }
        
        /* æŒ‰éˆ•èˆ‡æ§åˆ¶å€ */
        .controls-wrapper { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; align-items: center; }
        
        .btn { padding: 8px 16px; border: 1px solid var(--border); background: var(--bg-secondary); color: var(--text-primary); cursor: pointer; border-radius: 20px; transition: 0.2s; font-size: 0.9rem; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .btn.active { background: var(--accent); color: white; border-color: var(--accent); }
        .btn-danger { background: #e74c3c !important; color: white !important; border-color: #c0392b !important; }
        .btn-primary { background: var(--accent); color: white; border-color: var(--accent); }

        /* ä¸»é¡Œé¸æ“‡å™¨ - è‰²ç¥¨åœ“é» */
        .theme-selector { display: flex; gap: 8px; background: var(--bg-secondary); padding: 8px 12px; border-radius: 30px; box-shadow: 0 2px 10px var(--shadow); align-items: center; }
        .theme-dot { width: 24px; height: 24px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; transition: transform 0.2s; position: relative; }
        .theme-dot:hover { transform: scale(1.2); }
        .theme-dot.active { border-color: var(--text-primary); transform: scale(1.1); }
        .theme-dot::after { /* Tooltip */
            content: attr(data-title); position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.8); color: white; padding: 2px 6px; font-size: 10px; border-radius: 4px;
            white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity 0.2s;
        }
        .theme-dot:hover::after { opacity: 1; }

        /* ä¹å®®æ ¼ */
        .grid-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px; }
        .grid-item { 
            background: var(--bg-secondary); border: 2px solid var(--border); border-radius: 16px; 
            padding: 20px; min-height: 350px; 
            display: flex; flex-direction: column; /* å‚ç›´æ’åˆ— */
            box-shadow: 0 4px 15px var(--shadow); transition: 0.3s;
        }
        .grid-item:hover { border-color: var(--accent); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
        .grid-item.center { background: var(--center-bg); border: none; color: white; justify-content: center; align-items: center; }

        .grid-title { font-size: 1.2rem; font-weight: 700; margin-bottom: 10px; border-bottom: 2px solid var(--border); padding-bottom: 5px; }
        .grid-item.center .grid-title { border: none; color: white; }

        /* ç›®æ¨™åˆ—è¡¨å€åŸŸ (ä½”æ»¿å‰©é¤˜ç©ºé–“) */
        .goals-list { flex: 1; list-style: none; padding: 0; overflow-y: auto; margin-bottom: 15px; max-height: 200px; }
        
        .goal-item { display: flex; gap: 8px; padding: 6px 0; border-bottom: 1px dashed var(--border); align-items: flex-start; }
        .goal-item:last-child { border-bottom: none; }
        .goal-number { min-width: 20px; height: 20px; background: var(--accent); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; margin-top: 3px; }
        .goal-text { flex: 1; word-break: break-word; cursor: pointer; }
        .goal-checkbox { width: 16px; height: 16px; border: 2px solid var(--accent); border-radius: 4px; cursor: pointer; margin-top: 4px; }
        .goal-checkbox.checked { background: var(--accent); }
        
        /* åº•éƒ¨æ“ä½œå€ (è¼¸å…¥æ¡† + åœ–ç‰‡) */
        .grid-footer { margin-top: auto; }
        
        .add-input-wrapper { display: flex; gap: 5px; margin-bottom: 10px; }
        .add-input { flex: 1; padding: 8px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-primary); color: var(--text-primary); }
        .add-btn { padding: 8px 12px; background: var(--accent); color: white; border: none; border-radius: 8px; cursor: pointer; }

        /* åœ–ç‰‡é¡¯ç¤ºå€ - ç§»è‡³æœ€ä¸‹æ–¹ */
        .image-display-area { 
            width: 100%; min-height: 50px; 
            border: 2px dashed var(--border); border-radius: 8px; 
            display: flex; align-items: center; justify-content: center; 
            overflow: hidden; position: relative; margin-top: 5px;
            background: rgba(0,0,0,0.02);
        }
        .image-display-area img { width: 100%; height: auto; display: block; object-fit: cover; }
        .image-placeholder { color: var(--text-secondary); font-size: 0.8rem; pointer-events: none; }
        
        /* åœ–ç‰‡æ§åˆ¶æŒ‰éˆ• (æ‡¸æµ®åœ¨åœ–ç‰‡å€ä¸Šæ–¹) */
        .img-controls { 
            position: absolute; bottom: 5px; right: 5px; display: flex; gap: 5px; opacity: 0; transition: 0.3s; 
        }
        .image-display-area:hover .img-controls { opacity: 1; }
        .mini-btn { padding: 4px 8px; font-size: 12px; border-radius: 4px; border: none; cursor: pointer; color: white; }
        
        /* æ ¸å¿ƒè©å¤§å­— */
        .core-word-display { font-size: 4rem; font-weight: bold; background: transparent; border: 2px solid rgba(255,255,255,0.3); color: white; text-align: center; width: 100%; max-width: 200px; padding: 10px; }

        /* éŸ¿æ‡‰å¼ */
        @media (max-width: 900px) { .grid-container { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 600px) { .grid-container { grid-template-columns: 1fr; } }
    </style>
</head>
<body class="bamboo">
    <div class="container">
        <header>
            <h1>ä¹å®®æ ¼å¹´åº¦è¦åŠƒ</h1>
            <div class="controls-wrapper">
                <button class="btn active" onclick="switchPage('planner')">ğŸ“‹ è¦åŠƒ</button>
                <button class="btn" onclick="switchPage('stats')">ğŸ“Š çµ±è¨ˆ</button>
                
                <select id="yearSelect" class="btn" style="padding: 8px;"></select>
                
                <div class="theme-selector">
                    <div class="theme-dot" style="background:#6b9e78" data-theme="bamboo" data-title="ç«¹æ—"></div>
                    <div class="theme-dot" style="background:#ffb7c5" data-theme="sakura" data-title="æ«»èŠ±"></div>
                    <div class="theme-dot" style="background:#87ceeb" data-theme="lotus" data-title="è“®æ± "></div>
                    <div class="theme-dot" style="background:#ffab91" data-theme="sunset" data-title="æ™šéœ"></div>
                    <div class="theme-dot" style="background:#2196f3" data-theme="ocean" data-title="æ·±æµ·"></div>
                    <div class="theme-dot" style="background:#ce93d8" data-theme="lavender" data-title="è–°è¡£è‰"></div>
                    <div class="theme-dot" style="background:#ffcc80" data-theme="autumn" data-title="ç§‹æ¥“"></div>
                    <div class="theme-dot" style="background:#263238" data-theme="midnight" data-title="æš—å¤œ"></div>
                </div>
            </div>
            
            <div class="controls-wrapper">
                <button class="btn btn-primary" onclick="handleBackup()">ğŸ“¥ å‚™ä»½è³‡æ–™åº«</button>
                <button class="btn btn-primary" onclick="document.getElementById('restoreInput').click()">ğŸ“¤ é‚„åŸè³‡æ–™åº«</button>
                <input type="file" id="restoreInput" accept=".json" style="display:none" onchange="handleRestore(this)">
                <button class="btn btn-danger" onclick="handleClearData()">âš ï¸ æ¸…ç©ºè³‡æ–™</button>
            </div>
        </header>

        <div id="plannerPage">
            <div class="controls-wrapper">
                <button class="btn active mode-btn" data-mode="year" onclick="switchMode('year')">ğŸ“… å¹´åº¦</button>
                <button class="btn mode-btn" data-mode="month" onclick="switchMode('month')">ğŸ“† æœˆåº¦</button>
            </div>
            <div id="monthSelector" class="controls-wrapper" style="display:none;">
                <!-- JS ç”Ÿæˆæœˆä»½æŒ‰éˆ• -->
            </div>
            <div id="gridContainer" class="grid-container"></div>
        </div>

        <div id="statsPage" style="display:none;">
            <!-- çµ±è¨ˆå…§å®¹ç”± JS å‹•æ…‹ç”Ÿæˆ -->
            <div class="grid-item" style="width: 100%; text-align: center;">
                <h2>å®Œæˆé€²åº¦</h2>
                <div id="statsContent"></div>
            </div>
        </div>
    </div>

    <script>
        const GRID_CONFIG = [
            { id: 'learn', title: 'å­¸ç¿’&æˆé•·' }, { id: 'experience', title: 'é«”é©—&çªç ´' }, { id: 'relax', title: 'ä¼‘é–’&æ”¾é¬†' },
            { id: 'family', title: 'å®¶åº­&ç”Ÿæ´»' }, { id: 'core', title: 'æ ¸å¿ƒè©', isCenter: true }, { id: 'work', title: 'å·¥ä½œ&äº‹æ¥­' },
            { id: 'social', title: 'äººéš›&ç¤¾ç¾¤' }, { id: 'finance', title: 'è²¡å‹™&ç†è²¡' }, { id: 'health', title: 'å¥åº·&èº«é«”' }
        ];

        let currentMode = 'year';
        let currentMonth = new Date().getMonth() + 1;
        let currentYear = new Date().getFullYear();
        let currentTheme = 'bamboo';
        let allYearsData = {}; 

        // åˆå§‹åŒ–
        async function initApp() {
            initYearSelector();
            initMonthSelector();
            setupThemeListeners();
            await loadData();
            renderGrid();
        }

        // å¹´ä»½é¸æ“‡å™¨ (è‡³2100å¹´)
        function initYearSelector() {
            const select = document.getElementById('yearSelect');
            const startYear = 2020;
            const endYear = 2100;
            for (let y = startYear; y <= endYear; y++) {
                const opt = document.createElement('option');
                opt.value = y;
                opt.textContent = `${y}å¹´`;
                if (y === currentYear) opt.selected = true;
                select.appendChild(opt);
            }
            select.onchange = async (e) => {
                currentYear = parseInt(e.target.value);
                await loadData();
                renderGrid();
            };
        }

        function initMonthSelector() {
            const container = document.getElementById('monthSelector');
            for(let i=1; i<=12; i++) {
                const btn = document.createElement('button');
                btn.className = `btn ${i === currentMonth ? 'active' : ''}`;
                btn.textContent = `${i}æœˆ`;
                btn.onclick = () => {
                    currentMonth = i;
                    document.querySelectorAll('#monthSelector .btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    renderGrid();
                };
                container.appendChild(btn);
            }
        }

        function setupThemeListeners() {
            document.querySelectorAll('.theme-dot').forEach(dot => {
                dot.onclick = () => {
                    const theme = dot.dataset.theme;
                    currentTheme = theme;
                    document.body.className = theme;
                    if(allYearsData[currentYear]) {
                        allYearsData[currentYear].theme = theme;
                        saveData();
                    }
                };
            });
        }

        // è³‡æ–™çµæ§‹åˆå§‹åŒ–
        function initDataStructure(year) {
            if (allYearsData[year]) return;
            const yearData = {};
            const monthData = {};
            const backgroundImages = { year: {}, month: {} };
            GRID_CONFIG.forEach(c => {
                yearData[c.id] = { title: c.title, coreWord: '', goals: [] };
            });
            for(let m=1; m<=12; m++) {
                monthData[m] = {};
                GRID_CONFIG.forEach(c => { monthData[m][c.id] = { goals: [] }; });
                backgroundImages.month[m] = {};
            }
            allYearsData[year] = { yearData, monthData, theme: 'bamboo', backgroundImages };
        }

        // è³‡æ–™è¼‰å…¥ (API)
        async function loadData() {
            try {
                const res = await fetch(`/api/plan/${currentYear}`);
                if (res.status === 404) {
                    initDataStructure(currentYear);
                } else {
                    const data = await res.json();
                    allYearsData[currentYear] = data;
                    currentTheme = data.theme || 'bamboo';
                    document.body.className = currentTheme;
                }
            } catch (e) {
                console.error('è¼‰å…¥å¤±æ•—', e);
                initDataStructure(currentYear);
            }
        }

        // è³‡æ–™å„²å­˜ (API)
        function saveData() {
            const data = allYearsData[currentYear];
            fetch(`/api/plan/${currentYear}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            }).catch(e => console.error('å„²å­˜å¤±æ•—', e));
        }

        // æ¸²æŸ“ä¸»ç¶²æ ¼
        function renderGrid() {
            const container = document.getElementById('gridContainer');
            container.innerHTML = '';
            
            GRID_CONFIG.forEach(config => {
                const item = document.createElement('div');
                item.className = `grid-item ${config.isCenter ? 'center' : ''}`;
                
                if (config.isCenter) {
                    renderCenterCell(item, config);
                } else {
                    renderNormalCell(item, config);
                }
                container.appendChild(item);
            });
        }

        function renderCenterCell(item, config) {
            const data = allYearsData[currentYear].yearData[config.id];
            const word = data.coreWord || '';
            
            item.innerHTML = `
                <div class="grid-title">${config.title}</div>
                <input type="text" class="core-word-display" value="${word}" 
                    oninput="updateCoreWord(this.value)" placeholder="æ ¸å¿ƒè©">
            `;
        }

        function updateCoreWord(val) {
            allYearsData[currentYear].yearData['core'].coreWord = val;
            saveData();
        }

        function renderNormalCell(item, config) {
            const isYear = currentMode === 'year';
            const data = isYear ? allYearsData[currentYear].yearData[config.id] : allYearsData[currentYear].monthData[currentMonth][config.id];
            const bgImages = allYearsData[currentYear].backgroundImages;
            const imgSrc = isYear ? bgImages.year[config.id] : (bgImages.month[currentMonth][config.id] || bgImages.year[config.id]);

            // ç›®æ¨™åˆ—è¡¨ HTML
            const goalsHtml = data.goals.map((g, idx) => `
                <li class="goal-item">
                    <div class="goal-number">${idx+1}</div>
                    <div class="goal-checkbox ${g.completed?'checked':''}" onclick="toggleGoal('${config.id}', ${idx})"></div>
                    <div class="goal-text" contenteditable="true" onblur="updateGoal('${config.id}', ${idx}, this.innerText)">${g.text}</div>
                    <button class="mini-btn" style="color:#aaa" onclick="deleteGoal('${config.id}', ${idx})">Ã—</button>
                </li>
            `).join('');

            item.innerHTML = `
                <div class="grid-title">${config.title}</div>
                <ul class="goals-list">${goalsHtml}</ul>
                
                <div class="grid-footer">
                    <div class="add-input-wrapper">
                        <input type="text" class="add-input" placeholder="æ–°å¢ç›®æ¨™..." onkeypress="if(event.key==='Enter') addGoal('${config.id}', this)">
                        <button class="add-btn" onclick="addGoal('${config.id}', this.previousElementSibling)">+</button>
                    </div>
                    
                    <div class="image-display-area" onclick="document.getElementById('file-${config.id}').click()">
                        ${imgSrc ? `<img src="${imgSrc}">` : `<span class="image-placeholder">é»æ“Šä¸Šå‚³åœ–ç‰‡</span>`}
                        <div class="img-controls">
                            <button class="mini-btn" style="background:#2196f3" onclick="event.stopPropagation();document.getElementById('file-${config.id}').click()">æ›´æ›</button>
                            ${imgSrc ? `<button class="mini-btn" style="background:#f44336" onclick="event.stopPropagation();removeImage('${config.id}')">åˆªé™¤</button>` : ''}
                        </div>
                    </div>
                    <input type="file" id="file-${config.id}" style="display:none" accept="image/*" onchange="uploadImage('${config.id}', this)">
                </div>
            `;
        }

        // é‚è¼¯åŠŸèƒ½
        function addGoal(gridId, input) {
            if(!input.value.trim()) return;
            const isYear = currentMode === 'year';
            const targetData = isYear ? allYearsData[currentYear].yearData[gridId] : allYearsData[currentYear].monthData[currentMonth][gridId];
            
            targetData.goals.push({ text: input.value, completed: false });
            input.value = '';
            saveData();
            renderGrid();
        }

        function toggleGoal(gridId, idx) {
            const isYear = currentMode === 'year';
            const targetData = isYear ? allYearsData[currentYear].yearData[gridId] : allYearsData[currentYear].monthData[currentMonth][gridId];
            targetData.goals[idx].completed = !targetData.goals[idx].completed;
            saveData();
            renderGrid();
        }

        function updateGoal(gridId, idx, text) {
            const isYear = currentMode === 'year';
            const targetData = isYear ? allYearsData[currentYear].yearData[gridId] : allYearsData[currentYear].monthData[currentMonth][gridId];
            targetData.goals[idx].text = text;
            saveData();
        }

        function deleteGoal(gridId, idx) {
            if(!confirm('ç¢ºå®šåˆªé™¤?')) return;
            const isYear = currentMode === 'year';
            const targetData = isYear ? allYearsData[currentYear].yearData[gridId] : allYearsData[currentYear].monthData[currentMonth][gridId];
            targetData.goals.splice(idx, 1);
            saveData();
            renderGrid();
        }

        function uploadImage(gridId, input) {
            const file = input.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                const bgImages = allYearsData[currentYear].backgroundImages;
                if(currentMode === 'year') {
                    bgImages.year[gridId] = e.target.result;
                } else {
                    bgImages.month[currentMonth][gridId] = e.target.result;
                }
                saveData();
                renderGrid();
            };
            reader.readAsDataURL(file);
        }

        function removeImage(gridId) {
            const bgImages = allYearsData[currentYear].backgroundImages;
            if(currentMode === 'year') {
                delete bgImages.year[gridId];
            } else {
                delete bgImages.month[currentMonth][gridId];
            }
            saveData();
            renderGrid();
        }

        function switchMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`.mode-btn[data-mode="${mode}"]`).classList.add('active');
            document.getElementById('monthSelector').style.display = mode === 'month' ? 'flex' : 'none';
            renderGrid();
        }

        function switchPage(page) {
            document.getElementById('plannerPage').style.display = page === 'planner' ? 'block' : 'none';
            document.getElementById('statsPage').style.display = page === 'stats' ? 'block' : 'none';
            if(page === 'stats') updateStats();
        }

        function updateStats() {
            // ç°¡æ˜“çµ±è¨ˆé¡¯ç¤º
            let total = 0, done = 0;
            // çµ±è¨ˆå¹´åº¦
            Object.values(allYearsData[currentYear].yearData).forEach(g => {
                if(g.goals) {
                    total += g.goals.length;
                    done += g.goals.filter(x => x.completed).length;
                }
            });
            const percent = total === 0 ? 0 : Math.round((done/total)*100);
            document.getElementById('statsContent').innerHTML = `
                <div style="font-size:3rem; color:var(--accent); font-weight:bold;">${percent}%</div>
                <div>å¹´åº¦ç›®æ¨™ï¼šå®Œæˆ ${done} / ${total}</div>
            `;
        }

        // --- è³‡æ–™åº«æ“ä½œ ---
        async function handleBackup() {
            window.location.href = '/api/db/backup';
        }

        async function handleRestore(input) {
            const file = input.files[0];
            if(!file) return;
            
            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    const json = JSON.parse(e.target.result);
                    const res = await fetch('/api/db/restore', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(json)
                    });
                    const result = await res.json();
                    if(result.success) {
                        alert('é‚„åŸæˆåŠŸï¼é é¢å°‡é‡æ–°æ•´ç†ã€‚');
                        window.location.reload();
                    } else {
                        alert('é‚„åŸå¤±æ•—ï¼š' + result.error);
                    }
                } catch (err) {
                    alert('æª”æ¡ˆæ ¼å¼éŒ¯èª¤');
                }
            };
            reader.readAsText(file);
        }

        async function handleClearData() {
            if(!confirm('ç¢ºå®šæ¸…ç©ºæ‰€æœ‰è³‡æ–™åº«å…§å®¹ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) return;
            await fetch('/api/test/clear-data', { method: 'DELETE' });
            window.location.reload();
        }

        initApp();
    </script>
</body>
</html>
